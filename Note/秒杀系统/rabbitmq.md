# Rabbitmq介绍

1. rabbitmq是面向消息的中间件，用于组件之间的解耦，主要体现在消息的发送者和消费者之间无强依赖关系
2. rabbitmq特点：高可用、扩展性强、多语言客户端、管理界面等
3. 主要使用场景：流量削峰、异步处理、应用解耦等

![](D:\typora\Golang_Engineer\typora-user-images\rabbitmq环境安装.png)

```bash
127.0.0.1:15672
```

# 管理命令

## 启动命令

```bash
systemctl start rabbitmq-server
```

## 停止命令

```bash
rabbitmqctl stop
```

## 查看插件命令

```bash
rabbitmq-plugins list
```

## 安装启动管理页面命令

```bash
rabbitmq-plugins enable rabbitmq_management
```

## 日志管理

```b
rabbitmq-plugins enable rabbitmq_tracing
```

##  卸载插件

```b
rabbitmq-plugins disable +插件名
```

# 核心概念

## VirtualHost 

在 RabbitMQ 中，Virtual Host（虚拟主机）是一个逻辑分组概念，用于隔离和组织资源（如队列、交换器和绑定）。它允许在同一个 RabbitMQ 实例中，为不同的应用或者用户环境提供独立的命名空间。每个虚拟主机都拥有自己独立的资源和权限，这使得不同用户和应用之间的资源互不影响。

虚拟主机的作用如下：

1. 资源隔离：虚拟主机可以让你在同一个 RabbitMQ 实例中隔离不同应用程序的队列、交换器和绑定。这意味着每个应用程序可以拥有自己的独立资源，而不会与其他应用程序发生冲突。

2. 权限管理：RabbitMQ 支持基于虚拟主机的权限管理。这意味着你可以为每个虚拟主机分配不同的用户和权限。例如，你可以为一个虚拟主机分配只读权限，而为另一个虚拟主机分配读写权限。这有助于实现应用程序之间的安全隔离。

3. 简化配置：使用虚拟主机，你可以在同一个 RabbitMQ 实例中运行多个独立的应用程序或环境，而无需维护多个 RabbitMQ 实例。这可以减少配置和管理的复杂性。

默认情况下，RabbitMQ 实例中有一个名为“/”的虚拟主机。你可以根据需要创建更多的虚拟主机。要管理 RabbitMQ 的虚拟主机，可以使用 RabbitMQ 管理插件（Web 界面）或命令行工具 `rabbitmqctl` 和 `rabbitmqadmin`。

## Connection

在 RabbitMQ 中，Connection（连接）是指客户端（如应用程序）与 RabbitMQ 服务器之间建立的网络通信链路。连接是基于 TCP 协议的，允许客户端与 RabbitMQ 服务器进行双向通信，发送和接收消息。

Connection 在 RabbitMQ 中的作用如下：

1. 通信链路：连接为客户端和 RabbitMQ 服务器之间的通信提供了一个网络链路。通过这个链路，客户端可以将消息发布到 RabbitMQ 服务器，同时也可以从 RabbitMQ 服务器接收消息。

2. 资源管理：每个连接都会占用一定的网络和系统资源。RabbitMQ 服务器需要管理和跟踪这些连接。在某些情况下，为了保护服务器资源，RabbitMQ 可能会限制同时打开的连接数量。

3. 安全和认证：当客户端与 RabbitMQ 服务器建立连接时，通常需要进行身份验证。这是通过使用指定的用户名和密码进行的。RabbitMQ 可以配置不同的认证和授权策略，以确保只有合法的客户端可以访问服务器上的资源。

4. 连接参数和配置：连接是可配置的，客户端可以根据需要设置不同的连接参数。例如，客户端可以为连接设置心跳间隔（用于检测连接是否仍然活跃）和自动重连策略（在连接意外断开时自动恢复连接）。

在 RabbitMQ 中，客户端与服务器之间的连接是通过 AMQP 协议（或其变体，如 AMQP 1.0、AMQP 0-9-1）建立的。大多数编程语言都有支持 AMQP 协议的客户端库，可以方便地与 RabbitMQ 服务器建立连接。

## Exchanges

在 RabbitMQ 中，Exchanges（交换器）是一种消息路由机制，用于根据特定的规则将生产者发送的消息路由到一个或多个队列。交换器在消息传递过程中起到关键作用，它们接收生产者发送的消息并根据预先定义的绑定和路由键将这些消息路由到正确的队列。

Exchanges 在 RabbitMQ 中的作用如下：

1. 消息路由：交换器的主要职责是根据特定的策略将消息路由到一个或多个队列。这样，生产者只需要将消息发送到交换器，而无需关心消息的具体接收者。这有助于实现生产者和消费者之间的解耦。

2. 支持多种路由策略：RabbitMQ 支持多种类型的交换器，每种交换器都实现了不同的消息路由策略。这些类型包括：

   - Direct Exchange（直接交换器）：将消息路由到绑定键（binding key）与消息的路由键（routing key）完全匹配的队列。
   - Fanout Exchange（扇出交换器）：将消息广播到所有绑定到它的队列，不考虑路由键。
   - Topic Exchange（主题交换器）：将消息路由到绑定键与消息路由键匹配的队列，其中绑定键和路由键可以包含通配符。
   - Headers Exchange（头交换器）：基于消息头中的键值对进行匹配，而不是路由键。

3. 灵活的消息传递：通过使用不同类型的交换器和绑定规则，RabbitMQ 可以实现各种复杂的消息传递模式，如广播、多播、发布订阅等。

总之，Exchanges 在 RabbitMQ 中充当了消息路由器的角色，使得生产者可以将消息发送到正确的队列，从而实现复杂的消息传递模式。

## Channel

在 RabbitMQ 中，Channel（信道）是一个轻量级的连接子层，允许客户端在单个 TCP 连接上进行多路复用。通过使用信道，客户端可以在一个连接内同时执行多个并发操作，如发布消息、消费消息或创建队列等。

Channel 在 RabbitMQ 中的作用如下：

1. 多路复用：信道允许客户端在单个 TCP 连接中同时执行多个操作。这意味着你不需要为每个操作创建一个新的 TCP 连接。这有助于减小网络和系统资源的开销，提高性能。

2. 操作分离：信道可以将不同的操作隔离在不同的信道中，使得操作之间不会相互干扰。例如，在一个信道中发布消息，而在另一个信道中消费消息。这样可以确保一个操作不会阻塞另一个操作。

3. 流量控制：RabbitMQ 可以对信道进行流量控制，以防止消费者无法处理过多的消息。当消费者处理速度跟不上生产者时，RabbitMQ 会暂停向该信道发送消息，直到消费者处理完积压的消息。

4. 错误处理：信道可以在出现错误时进行独立的错误处理。当一个信道发生错误时，只会影响该信道，而不会影响同一连接中的其他信道。这有助于保持系统的稳定性和可用性。

要在 RabbitMQ 中使用信道，你需要使用客户端库（如 Pika、Java 客户端等）创建一个信道实例。然后，通过该实例执行各种操作，如创建队列、发布消息或消费消息等。当操作完成后，需要关闭信道以释放资源。

## Queue

在 RabbitMQ 中，Queue（队列）是一种用于存储和传递消息的数据结构。队列是由生产者发布的消息的缓冲区，并按照先进先出（FIFO）的顺序存储消息。消费者可以从队列中获取并处理消息，以实现异步通信和任务分发。

Queue 在 RabbitMQ 中的作用如下：

1. 消息缓冲：队列充当生产者和消费者之间的缓冲区，使生产者可以继续发送消息，即使消费者暂时无法处理这些消息。这有助于应对生产者和消费者之间的速率差异，提高系统的吞吐量和性能。

2. 消息持久化：RabbitMQ 支持将队列中的消息持久化到磁盘。这意味着即使 RabbitMQ 服务器发生故障或重启，消息也不会丢失。生产者和消费者可以在系统恢复正常后继续处理消息。

3. 负载均衡：在 RabbitMQ 中，你可以有多个消费者订阅同一个队列。当多个消费者订阅同一个队列时，RabbitMQ 会按照一定的策略将消息分发给不同的消费者。这有助于实现负载均衡和任务分发。

4. 消息确认和重试：RabbitMQ 支持消息确认机制，允许消费者在成功处理消息后发送确认信号。如果消费者无法处理消息（如发生错误或崩溃），RabbitMQ 可以将消息重新放回队列以供其他消费者处理。这有助于确保消息在处理过程中不会丢失。

5. 队列属性和配置：队列在 RabbitMQ 中具有多种属性和配置选项，如队列持久化、排他性、消息TTL（生存时间）等。这些选项使得队列可以根据应用程序的需求进行定制。

总之，Queue 在 RabbitMQ 中是用于存储和传递消息的核心数据结构，它使生产者和消费者能够进行异步通信和任务分发。队列的属性和配置选项使得 RabbitMQ 可以满足各种应用场景的需求。

## Binding

在 RabbitMQ 中，Binding（绑定）是一种将 Exchange（交换器）与 Queue（队列）关联起来的机制。绑定允许交换器知道如何将接收到的消息路由到正确的队列。每个绑定都有一个 Binding Key（绑定键），用于定义交换器如何根据消息的 Routing Key（路由键）将消息路由到队列。

Binding 在 RabbitMQ 中的作用如下：

1. 消息路由：绑定允许交换器将生产者发送的消息路由到正确的队列。通过在交换器和队列之间创建绑定，你可以定义消息传递的路径，实现复杂的消息路由策略。

2. 支持多种交换器类型：RabbitMQ 支持多种交换器类型，如 Direct Exchange（直接交换器）、Fanout Exchange（扇出交换器）、Topic Exchange（主题交换器）和 Headers Exchange（头交换器）。每种交换器类型都有自己的绑定规则和路由策略。通过为不同类型的交换器创建绑定，你可以实现各种消息路由模式，如单播、广播、多播等。

3. 灵活的消息传递：绑定允许你为同一个队列创建多个绑定。这意味着一个队列可以接收来自多个交换器或多个路由键的消息。这使得 RabbitMQ 可以实现更复杂的消息传递模式，如发布订阅、工作队列等。

4. 动态创建和删除：绑定可以在运行时被创建和删除，无需重启 RabbitMQ 服务器。这使得应用程序可以根据需要动态地调整消息传递路径，以适应不断变化的需求。

要在 RabbitMQ 中使用 Binding，你需要使用客户端库（如 Pika、Java 客户端等）创建一个 Exchange 和一个 Queue。然后，你可以使用 Binding Key 为两者创建一个绑定。当生产者发送消息到交换器时，交换器会根据 Binding Key 和消息的 Routing Key 将消息路由到正确的队列。